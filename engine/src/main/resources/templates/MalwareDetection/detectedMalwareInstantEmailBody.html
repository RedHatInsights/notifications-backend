{#include MalwareDetection/insightsEmailBody}
{#content-title}Malware Detection instant notification - {action.timestamp.toStringFormat()}{/content-title}
{#content-body}
{#let payload=action.events[0].payload matches=action.events[0].payload.matched_rules.size()}
<!-- Body section -->
<tr>
  <td class="rh-body">
    <table class="rh-content" role="presentation" align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr>
        <td>
          <table class="rh-content" role="presentation" align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
            <tbody>

              <!-- Number of new matched signatures section -->
              <tr>
                <td>
                  <table class="rh-content" role="presentation" align="center" border="0" cellpadding="0" width="100%">
                    <tr>
                      <td class="rh-card rh-m-danger" style="width: 10%;">
                        <img src="https://console.redhat.com/apps/frontend-assets/email-assets/lightning-bolt-light.png" alt="" width="30">
                      </td>
                      <td class="rh-card rh-m-danger rh-card-metrics" style="padding-left: 0; width: 90%">
                        <p style="margin-bottom: 0 !important; font-weight: bold !important;">New matches</p>
                        <p class="rh-metric__count" style="margin-bottom: 0 !important;">{matches}</p>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <!-- End number of new matched signatures section -->

              <!-- Empty row to space out content -->
              <tr>
                <td class="rh-body rh-multi-column">
                  <table class="rh-content" role="presentation" align="center" border="0" cellpadding="0" width="100%">
                    <tbody><tr><td></td></tr></tbody>
                  </table>
                </td>
              </tr>
              <!-- end empty row -->

              <!-- User message section -->
              <tr>
                <td class="rh-content__block">
                  Hi {user.firstName},
                  <br>
                  <br>
                  Your system <a target="_blank" href="{environment.url}/insights/malware/systems/{payload.host_id}">{payload.host_name}</a>
                  matched {matches} signature{#if matches > 1}s{/if}.  For more details, go to Malware Detection.
                  <br>
                  <br>
                </td>
              </tr>
              <!-- end user message section -->

              <!-- Button for navigating to the Insights UI -->
              <tr>
                <td class="rh-content__block" style="-ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; mso-table-lspace: 0pt !important; mso-table-rspace: 0pt !important; max-width: 100%; padding-top: 0; padding-right: 24px; padding-bottom: 24px; padding-left: 24px; overflow: hidden; background-color: #ffffff;">
                  <table role="presentation" border="0" cellpadding="0" cellspacing="0" align="center" class="rh-button-table" style="-ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; mso-table-lspace: 0pt !important; mso-table-rspace: 0pt !important; border-collapse: collapse !important; width: auto; background: none !important; background-color: transparent;">
                    <tr style="-ms-text-size-adjust: 100%;">
                      <td class="rh-cta-link" align="center" style="-ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; mso-table-lspace: 0pt !important; mso-table-rspace: 0pt !important; display: block; padding-top: 12px; padding-right: 24px; padding-bottom: 12px; padding-left: 24px; background-color: #0066cc !important; border-radius: 3px; text-decoration: none;">
                        <a target="_blank" href="{environment.url}/insights/malware/systems/{payload.host_id}" style="-ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; text-decoration: none !important; color: #fff !important; font-weight: 400; font-size: 18px;">
                          <span>Go to system page</span>
                        </a>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <!-- end button -->

              <!-- List of matched signatures section -->
              <tr>
                <td style="padding: 1em 0.5em; font-weight: bolder;">
                  Signature{#if matches > 1}s{/if} affecting <a target="_blank" href="{environment.url}/insights/malware/systems/{payload.host_id}">{payload.host_name}</a>
                </td>
              </tr>
              <tr>
                <td>
                  <table class="rh-content" role="presentation" align="center" border="0" cellpadding="0" width="100%">
                    <thead style="background-color: #c5e6f1; text-align: left">
                    <tr>
                      <th style="padding: 0.5em; width: 50%">Signature name</th>
                      <th style="padding: 0.5em; width: 20%">Last status</th>
                      <th style="padding: 0.5em; width: 30%">Matched</th>
                    </tr>
                    </thead>
                    <tbody style="background-color: white;">
                    {#for rule in payload.matched_rules}
                      <tr style="border-bottom: thin lightgrey solid">
                      <td style="padding: 0.5em; width: 50%;">{rule}</td>
                      <td style="padding: 0.5em; width: 20%">
                        <span style="border-radius: 1em; border: thin black solid; background-color: lightgrey; padding: 0 0.5em;">Matched</span>
                      </td>
                      <td style="padding: 0.5em; width: 30%">{payload.matched_at.toUtcFormat()}</td>
                      </tr>
                    {/for}
                    </tbody>
                  </table>
              </tr>
              <!-- End list of matched signatures section -->

            </tbody>
          </table>
        </td>
      </tr>
    </table>
  </td>
</tr>
{/let}
<!-- end body section -->
{/content-body}
{/include}
